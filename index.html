<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ì„œì‚¬ êµ¬ì¡° ì œì–´ê¸° (Narrative Structure Controller)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* ë¦¬ë””ë°”íƒ• í°íŠ¸ ì ìš© */
      @font-face {
        font-family: "Ridibatang";
        src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_twelve@1.0/RIDIBatang.woff")
          format("woff");
        font-weight: normal;
        font-display: swap;
      }

      :root {
        --bg-paper: #fdfbf7;
        --text-ink: #2c2c2c;
      }

      body {
        font-family: "Ridibatang", serif;
        background-color: var(--bg-paper);
        color: var(--text-ink);
        line-height: 1.8;
      }

      /* ìŠ¤í¬ë¡¤ë°” */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 3px;
      }

      .glass-panel {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
      }

      /* --- í…Œë§ˆë³„ ìŠ¤íƒ€ì¼ ì •ì˜ (CSS Variables ëŒ€ì‹  ì§ì ‘ í´ë˜ìŠ¤ ì œì–´ ë°©ì‹ í™œìš©) --- */

      /* ê³µí†µ: í•˜ì´ë¼ì´íŠ¸ ì „í™˜ íš¨ê³¼ */
      .highlight-dialogue,
      .highlight-thought {
        transition: all 0.3s ease;
        -webkit-box-decoration-break: clone;
        box-decoration-break: clone;
      }

      /* âœ¨ ìŠ¤íƒ€ì¼ 1: ìˆœìˆ˜ íƒ€ì´í¬ê·¸ë˜í”¼ (Default) */
      [data-theme="typography"] .highlight-dialogue {
        color: #1a0f0a;
        font-weight: 500;
      }
      [data-theme="typography"] .highlight-thought {
        color: #8b7b6a;
        font-weight: 400;
        font-style: normal;
      }

      /* âœ¨ ìŠ¤íƒ€ì¼ 2: ì€ì€í•œ í•˜ì´ë¼ì´íŠ¸ */
      [data-theme="subtle"] .highlight-dialogue {
        background-color: rgba(0, 0, 0, 0.03);
        color: #2d1b0e;
        padding: 0.15em 0.3em;
        border-radius: 2px;
      }
      [data-theme="subtle"] .highlight-thought {
        color: #9b8b7e;
      }

      /* âœ¨ ìŠ¤íƒ€ì¼ 3: ë“¤ì—¬ì“°ê¸° + ë¼ì¸ */
      [data-theme="indent"] .highlight-dialogue {
        margin-left: 0.5em; /* 1emì€ ë„ˆë¬´ ë„“ì„ ìˆ˜ ìˆì–´ ì¡°ì • */
        color: #2d1b0e;
      }
      [data-theme="indent"] .highlight-thought {
        border-left: 1px solid #d5ccc0;
        padding-left: 0.5em;
        margin-left: 0.2em;
        color: #8b7b6a;
      }

      /* âœ¨ ìŠ¤íƒ€ì¼ 4: ê¸€ì í¬ê¸° ì°¨ì´ */
      [data-theme="size"] .highlight-dialogue {
        font-size: 1.05em;
        color: #2d1b0e;
        font-weight: 500;
      }
      [data-theme="size"] .highlight-thought {
        font-size: 0.95em;
        color: #9b8b7e;
        opacity: 0.9;
      }

      /* âœ¨ ìŠ¤íƒ€ì¼ 5: í•˜ì´ë¸Œë¦¬ë“œ */
      [data-theme="hybrid"] .highlight-dialogue {
        color: #1a0f0a;
        font-weight: 500;
        background: linear-gradient(
          to bottom,
          transparent 0%,
          rgba(255, 243, 224, 0.4) 50%,
          transparent 100%
        );
      }
      [data-theme="hybrid"] .highlight-thought {
        color: #8b7b6a;
      }

      /* í…Œë§ˆ ë²„íŠ¼ í™œì„± ìƒíƒœ */
      .theme-active {
        ring-width: 2px;
        ring-color: #374151;
        background-color: #f8fafc;
      }

      input,
      textarea {
        font-family: "Ridibatang", serif;
        font-size: 16px;
      }

      /* ğŸ ë¹µ ë²„íŠ¼ */
      .btn-bread {
        background-color: #fff7ed;
        border: 1px solid #ffedd5;
        color: #1f2937;
        font-size: 1rem;
        padding: 4px 8px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        flex-shrink: 0;
      }
      .btn-bread:hover {
        background-color: #ffedd5;
        transform: translateY(-2px);
      }

      /* ëª¨ë°”ì¼: ê³ ì • ë†’ì´ ëŒ€ì‹  ìœ ì—°í•œ ë†’ì´ */
      @media (max-width: 768px) {
        .input-area {
          height: 220px !important;
        }
        .output-area {
          height: 320px !important;
        }
      }

      /* ğŸ’¬ íˆ´íŒ */
      .tooltip-wrap {
        position: relative;
        display: inline-flex;
        align-items: center;
      }
      .tooltip-wrap .tooltip-box {
        visibility: hidden;
        opacity: 0;
        pointer-events: none;
        position: absolute;
        bottom: calc(100% + 6px);
        left: 50%;
        transform: translateX(-50%);
        background: #1e293b;
        color: #f1f5f9;
        font-size: 11px;
        font-family: -apple-system, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
        font-weight: 400;
        line-height: 1.5;
        padding: 6px 10px;
        border-radius: 6px;
        white-space: nowrap;
        z-index: 50;
        transition: opacity 0.15s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }
      .tooltip-wrap .tooltip-box::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #1e293b;
      }
      .tooltip-wrap:hover .tooltip-box {
        visibility: visible;
        opacity: 1;
      }

      /* ğŸ”½ í† ê¸€ ì„¹ì…˜ */
      .toggle-body {
        overflow: hidden;
        max-height: 0;
        transition: max-height 0.3s ease, opacity 0.3s ease;
        opacity: 0;
      }
      .toggle-body.open {
        max-height: 200px;
        opacity: 1;
      }
      .toggle-chevron {
        transition: transform 0.3s ease;
      }
      .toggle-chevron.open {
        transform: rotate(180deg);
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col" data-theme="typography">
    <!-- Header -->
    <header
      class="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm"
    >
      <div
        class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center gap-3"
      >
        <div class="flex items-center gap-2">
          <button class="btn-bread" onclick="goHome()" title="í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°">
            ğŸï¸
          </button>
          <h1
            class="text-lg md:text-xl font-bold tracking-tight text-slate-800 flex items-center"
          >
            <i class="fas fa-pen-nib mr-2 text-slate-600"></i>ì„œì‚¬ êµ¬ì¡° ì œì–´ê¸°
          </h1>
        </div>
        <div class="text-xs text-slate-500 font-mono hidden md:block">
          Ver 2.6 / Original View
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 md:p-8">
      <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Control Panel -->
        <div class="lg:col-span-4 space-y-6">
          <!-- Constraints Input -->
          <div class="glass-panel p-5 rounded-lg relative">
            <div class="flex justify-between items-center mb-4">
              <h2
                class="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center"
              >
                <i class="fas fa-sliders-h mr-2"></i> ì œì•½ ì¡°ê±´
              </h2>
              <!-- Reset Button -->
              <button
                onclick="resetConstraints()"
                class="text-xs text-slate-400 hover:text-slate-600 border border-slate-200 hover:border-slate-400 px-2 py-1 rounded transition flex items-center"
                title="ì…ë ¥ê°’ ì´ˆê¸°í™”"
              >
                <i class="fas fa-undo-alt mr-1"></i> ì´ˆê¸°í™”
              </button>
            </div>

            <div class="space-y-4">
              <!-- ë¬¸ë‹¨ ìˆ˜ -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-bold text-slate-700 mb-1.5 flex items-center gap-1">
                    ìµœëŒ€ ë¬¸ë‹¨ ìˆ˜
                    <span class="tooltip-wrap">
                      <i class="fas fa-question-circle text-slate-300 text-[11px] cursor-default"></i>
                      <span class="tooltip-box">ì¶œë ¥ ê²°ê³¼ì˜ ë¬¸ë‹¨(ë‹¨ë½) ìˆ˜ë¥¼<br>ì œí•œí•©ë‹ˆë‹¤. ì´ˆê³¼ë¶„ì€ ì˜ë¦½ë‹ˆë‹¤.</span>
                    </span>
                  </label>
                  <input
                    type="number"
                    id="maxParagraphs"
                    min="1"
                    placeholder="âˆ"
                    class="w-full p-3 bg-slate-50 border border-slate-200 rounded focus:ring-1 focus:ring-slate-400 focus:outline-none transition text-center font-bold text-slate-700 placeholder-slate-300"
                  />
                </div>
                <div>
                  <label class="block text-sm font-bold text-slate-700 mb-1.5 flex items-center gap-1">
                    ë¬¸ë‹¨ ë‹¹ ë¬¸ì¥
                    <span class="tooltip-wrap">
                      <i class="fas fa-question-circle text-slate-300 text-[11px] cursor-default"></i>
                      <span class="tooltip-box">í•œ ë¬¸ë‹¨ ì•ˆì— ë“¤ì–´ê°ˆ<br>ìµœëŒ€ ë¬¸ì¥ ìˆ˜ì…ë‹ˆë‹¤.</span>
                    </span>
                  </label>
                  <input
                    type="number"
                    id="maxSentences"
                    min="1"
                    placeholder="âˆ"
                    class="w-full p-3 bg-slate-50 border border-slate-200 rounded focus:ring-1 focus:ring-slate-400 focus:outline-none transition text-center font-bold text-slate-700 placeholder-slate-300"
                  />
                </div>
              </div>

              <!-- ì „ì²´ ì¶œë ¥ ì œí•œ í† ê¸€ -->
              <div class="border-t border-slate-100 pt-3 mt-1">
                <button
                  onclick="toggleWordLimit()"
                  class="w-full flex items-center justify-between text-[10px] font-bold text-slate-400 uppercase tracking-widest hover:text-slate-600 transition group"
                >
                  <span class="flex items-center gap-1.5">
                    <i class="fas fa-text-width text-[9px]"></i>
                    ì „ì²´ ì¶œë ¥ ì œí•œ
                    <span class="tooltip-wrap">
                      <i class="fas fa-question-circle text-slate-300 text-[11px] cursor-default normal-case"></i>
                      <span class="tooltip-box" style="text-transform:none; letter-spacing:normal;">ë¬¸ë‹¨Â·ë¬¸ì¥ ì œí•œê³¼ ë³„ê°œë¡œ,<br>ì „ì²´ ì¶œë ¥ì˜ ë‹¨ì–´ ìˆ˜ ë˜ëŠ”<br>ê¸€ì ìˆ˜ ìƒí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.</span>
                    </span>
                  </span>
                  <i id="wordLimitChevron" class="fas fa-chevron-down toggle-chevron text-slate-300 group-hover:text-slate-500"></i>
                </button>

                <!-- í† ê¸€ ë°”ë”” -->
                <div id="wordLimitBody" class="toggle-body mt-3">
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-bold text-slate-700 mb-1.5">
                        ìµœëŒ€ ë‹¨ì–´ ìˆ˜
                      </label>
                      <input
                        type="number"
                        id="maxWords"
                        min="1"
                        placeholder="âˆ"
                        class="w-full p-3 bg-slate-50 border border-slate-200 rounded focus:ring-1 focus:ring-slate-400 focus:outline-none transition text-center font-bold text-slate-700 placeholder-slate-300"
                      />
                      <p class="text-[10px] text-slate-400 text-center mt-1">ì˜ì–´ ë‹¨ì–´</p>
                    </div>
                    <div>
                      <label class="block text-sm font-bold text-slate-700 mb-1.5">
                        ìµœëŒ€ ê¸€ì ìˆ˜
                      </label>
                      <input
                        type="number"
                        id="maxChars"
                        min="1"
                        placeholder="âˆ"
                        class="w-full p-3 bg-slate-50 border border-slate-200 rounded focus:ring-1 focus:ring-slate-400 focus:outline-none transition text-center font-bold text-slate-700 placeholder-slate-300"
                      />
                      <p class="text-[10px] text-slate-400 text-center mt-1">í•œêµ­ì–´ ê¸€ì</p>
                    </div>
                  </div>
                </div>
              </div>

              <p class="text-xs text-slate-400 text-center mt-2">
                * ë¹„ì›Œë‘ë©´ ì›ë³¸ì˜ í˜•íƒœë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.
              </p>
            </div>
          </div>

          <!-- Theme Selector -->
          <div class="glass-panel p-5 rounded-lg">
            <h2
              class="text-xs font-bold text-slate-400 mb-3 uppercase tracking-widest flex items-center"
            >
              <i class="fas fa-palette mr-2"></i> í•˜ì´ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼
            </h2>
            <div class="flex flex-col gap-2">
              <!-- Theme 1 -->
              <button
                onclick="setTheme('typography')"
                class="theme-btn p-2 rounded border border-slate-200 hover:bg-slate-50 text-xs text-slate-600 flex items-center justify-between transition theme-active"
                id="btn-typography"
              >
                <span class="font-bold"
                  >1. ìˆœìˆ˜ íƒ€ì´í¬ê·¸ë˜í”¼
                  <span class="text-[10px] text-amber-600 ml-1 font-normal"
                    >â˜… ì¶”ì²œ</span
                  ></span
                >
                <div class="text-[10px] text-slate-400">Aa</div>
              </button>
              <!-- Theme 2 -->
              <button
                onclick="setTheme('subtle')"
                class="theme-btn p-2 rounded border border-slate-200 hover:bg-slate-50 text-xs text-slate-600 flex items-center justify-between transition"
                id="btn-subtle"
              >
                <span class="font-bold">2. ì€ì€í•œ í•˜ì´ë¼ì´íŠ¸</span>
                <div
                  class="w-3 h-3 rounded bg-gray-100 border border-gray-200"
                ></div>
              </button>
              <!-- Theme 3 -->
              <button
                onclick="setTheme('indent')"
                class="theme-btn p-2 rounded border border-slate-200 hover:bg-slate-50 text-xs text-slate-600 flex items-center justify-between transition"
                id="btn-indent"
              >
                <span class="font-bold">3. ë“¤ì—¬ì“°ê¸° + ë¼ì¸</span>
                <div class="w-1 h-3 border-l border-slate-300"></div>
              </button>
              <!-- Theme 4 -->
              <button
                onclick="setTheme('size')"
                class="theme-btn p-2 rounded border border-slate-200 hover:bg-slate-50 text-xs text-slate-600 flex items-center justify-between transition"
                id="btn-size"
              >
                <span class="font-bold">4. ê¸€ì í¬ê¸° ì°¨ì´</span>
                <div class="flex items-end">
                  <span class="text-[10px]">A</span
                  ><span class="text-[14px]">A</span>
                </div>
              </button>
              <!-- Theme 5 -->
              <button
                onclick="setTheme('hybrid')"
                class="theme-btn p-2 rounded border border-slate-200 hover:bg-slate-50 text-xs text-slate-600 flex items-center justify-between transition"
                id="btn-hybrid"
              >
                <span class="font-bold">5. í•˜ì´ë¸Œë¦¬ë“œ</span>
                <div class="w-3 h-3 rounded bg-orange-50"></div>
              </button>
            </div>
          </div>

          <!-- Action Panel -->
          <div class="glass-panel p-5 rounded-lg">
            <div class="flex flex-col gap-3">
              <button
                onclick="processText()"
                class="w-full bg-slate-800 hover:bg-slate-700 text-white py-3.5 rounded-lg font-bold transition shadow-md flex justify-center items-center active:scale-[0.98]"
              >
                <i class="fas fa-bolt mr-2 text-yellow-400"></i> êµ¬ì¡°í™” ì‹¤í–‰
              </button>

              <button
                onclick="insertSample()"
                class="w-full bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 py-3 rounded-lg font-medium transition text-sm flex items-center justify-center gap-3 shadow-sm group"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-5 h-5 text-slate-400 group-hover:text-slate-600 transition"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                  <path
                    d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"
                  ></path>
                </svg>
                <span>[ì˜ˆì‹œ] íŒŒë„ì˜ í‹ˆìƒˆì—ì„œ</span>
              </button>

              <button
                onclick="clearAll()"
                class="w-full text-slate-400 hover:text-red-500 py-2 text-xs transition mt-1 flex justify-center items-center group"
              >
                <i
                  class="fas fa-trash-alt mr-1.5 group-hover:rotate-12 transition-transform"
                ></i>
                ë°ì´í„° ë¹„ìš°ê¸°
              </button>
            </div>
          </div>
        </div>

        <!-- Input/Output Area -->
        <div class="lg:col-span-8 space-y-6">
          <!-- Source Input -->
          <div
            class="glass-panel p-5 rounded-lg flex flex-col h-[300px] md:h-[350px] input-area"
          >
            <div
              class="flex justify-between items-center mb-3 pb-2 border-b border-slate-100"
            >
              <h2
                class="text-xs font-bold text-slate-400 uppercase tracking-widest"
              >
                <i class="fas fa-keyboard mr-2"></i>ì›ë³¸ (Source)
              </h2>
              <span
                id="sourceCount"
                class="text-xs font-bold font-mono text-slate-500 bg-slate-100 px-2 py-1 rounded"
                >0ì / 0ë¬¸ì¥</span
              >
            </div>
            <textarea
              id="sourceText"
              class="flex-grow w-full p-2 bg-transparent border-0 resize-none focus:outline-none text-base leading-relaxed placeholder-slate-300"
              placeholder="ì´ê³³ì— ë‹¤ë“¬ì„ í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. &#13;&#10;ì œì•½ ì¡°ê±´ì„ ë¹„ì›Œë‘ë©´ ì›ë³¸ í˜•íƒœ ê·¸ëŒ€ë¡œ í‘œì‹œë©ë‹ˆë‹¤."
            ></textarea>
          </div>

          <!-- Result Output -->
          <div
            class="glass-panel p-5 rounded-lg flex flex-col h-[400px] md:h-[500px] relative output-area"
          >
            <div
              class="flex justify-between items-center mb-3 pb-2 border-b border-slate-100"
            >
              <h2
                class="text-xs font-bold text-slate-800 uppercase tracking-widest flex items-center"
              >
                <i class="fas fa-quote-left mr-2 text-slate-400"></i>ê²°ê³¼
                (Result)
              </h2>

              <div class="flex items-center gap-3">
                <span
                  id="outputCount"
                  class="text-xs font-bold font-mono text-indigo-600 bg-indigo-50 px-2 py-1 rounded transition-opacity opacity-0"
                  >0ì / 0ë¬¸ì¥</span
                >
                <button
                  onclick="copyToClipboard()"
                  class="text-xs bg-slate-800 text-white px-3 py-1.5 rounded hover:bg-slate-700 transition flex items-center shadow-sm"
                >
                  <i class="fas fa-copy mr-1.5"></i> ë³µì‚¬
                </button>
              </div>
            </div>

            <!-- Output Content Area -->
            <div
              id="outputArea"
              class="flex-grow w-full p-2 bg-transparent overflow-y-auto text-base md:text-lg leading-loose whitespace-pre-line text-slate-800"
            >
              <div
                class="h-full flex flex-col items-center justify-center text-slate-300 space-y-3"
              >
                <i class="fas fa-align-left text-3xl opacity-30"></i>
                <span class="text-sm">ì¢Œì¸¡ì˜ 'êµ¬ì¡°í™” ì‹¤í–‰'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</span>
              </div>
            </div>

            <!-- Bottom Toast -->
            <div
              id="resultStats"
              class="absolute bottom-6 right-6 bg-slate-800/90 backdrop-blur text-white text-xs px-4 py-2 rounded-full opacity-0 transition-opacity duration-300 shadow-lg pointer-events-none"
            >
              ê²°ê³¼ ì—†ìŒ
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // DOM Elements
      const maxParagraphsInput = document.getElementById("maxParagraphs");
      const maxSentencesInput = document.getElementById("maxSentences");
      const maxWordsInput = document.getElementById("maxWords");
      const maxCharsInput = document.getElementById("maxChars");
      const sourceTextInput = document.getElementById("sourceText");
      const outputArea = document.getElementById("outputArea");
      const sourceCount = document.getElementById("sourceCount");
      const outputCount = document.getElementById("outputCount");
      const resultStats = document.getElementById("resultStats");

      function goHome() {
        window.location.href = "https://toastout.github.io/toast/";
      }

      function toggleWordLimit() {
        const body = document.getElementById("wordLimitBody");
        const chevron = document.getElementById("wordLimitChevron");
        const isOpen = body.classList.contains("open");
        body.classList.toggle("open", !isOpen);
        chevron.classList.toggle("open", !isOpen);
      }

      // Sample Data
      const sampleText = `ë‚˜ëŠ” ë‚¡ì€ ìš´ë™í™” ëˆì„ ê³ ì³ ë§¤ê³ , ëª¨ë˜ì‚¬ì¥ ìœ„ë¡œ ì²«ë°œì„ ë‚´ë””ë ë‹¤. 'ì´ê²Œ ì •ë§ ë§ëŠ” ê¸¸ì¼ê¹Œ?' ë°œë°‘ì—ì„œ ë°”ìŠ¤ë½ê±°ë¦¬ëŠ” ì†Œë¦¬ê°€ ë‚¬ë‹¤. ê·¸ê²ƒì€ ë§ˆì¹˜ ì˜¤ë«ë™ì•ˆ ìŠê³  ì§€ëƒˆë˜ ë‚´ ì•ˆì˜ ì–´ë–¤ ê°ê°ì„ ê¹¨ìš°ëŠ” ì‹ í˜¸ ê°™ì•˜ë‹¤.

ë°”ë‹¤ëŠ” ê±°ëŒ€í•˜ê³  ë¬´ì‹¬í–ˆë‹¤. íŒŒë„ëŠ” ëŠì„ì—†ì´ ë°€ë ¤ì™”ë‹¤ê°€ ë¶€ì„œì§€ê³ , ë‹¤ì‹œ ë°€ë ¤ë‚˜ê°”ë‹¤. ê·¸ ë°˜ë³µì ì¸ ë¦¬ë“¬ì„ ë³´ê³  ìˆìë‹ˆ, ì„œìš¸ì—ì„œì˜ ë³µì¡í–ˆë˜ ì¼ìƒì´ ë§ˆì¹˜ ë‹¤ë¥¸ í–‰ì„±ì˜ ì¼ì²˜ëŸ¼ ì•„ë“í•˜ê²Œ ëŠê»´ì¡Œë‹¤. 'ê·¸ë˜, ì—¬ê¸°ì„  ì•„ë¬´ë„ ë‚˜ë¥¼ ëª¨ë¥´ì§€.' ë‚˜ëŠ” ì£¼ë¨¸ë‹ˆì— ì†ì„ ì°”ëŸ¬ ë„£ê³ , ì°¨ê°€ìš´ ë°”ë‹·ë°”ëŒì„ ì •ë©´ìœ¼ë¡œ ë§ì•˜ë‹¤.

'í–‰ë³µí•˜ë‹¤.' ë¼ê³  ë§í•˜ê¸°ì—” ì–´ë”˜ê°€ ì‘¥ìŠ¤ëŸ¬ì› ë‹¤. í•˜ì§€ë§Œ ì ì–´ë„, ì§€ê¸ˆ ì´ ìˆœê°„ë§Œí¼ì€ ë‚´ê°€ ë‚˜ë¡œì„œ ì¡´ì¬í•œë‹¤ëŠ” ì‹¤ê°ì´ ë‚¬ë‹¤. ëˆ„êµ¬ì˜ ë”¸ë„, ëˆ„êµ¬ì˜ ì§ì›ë„, ëˆ„êµ¬ì˜ ì—°ì¸ë„ ì•„ë‹Œ, ê·¸ì € ë°”ë‹¤ë¥¼ ë°”ë¼ë³´ëŠ” í•œ ëª…ì˜ ì¸ê°„ìœ¼ë¡œì„œ.

ë‚˜ëŠ” ëª¨ë˜ ìœ„ì— í„¸ì© ì£¼ì €ì•‰ì•˜ë‹¤. ìˆ˜í‰ì„  ë„ˆë¨¸ë¡œ í•´ê°€ ë‰˜ì—¿ë‰˜ì—¿ ë„˜ì–´ê°€ê³  ìˆì—ˆë‹¤. ë¶‰ê²Œ ë¬¼ë“œëŠ” í•˜ëŠ˜ì„ ë³´ë©° ìƒê°í–ˆë‹¤. 'ì–´ì©Œë©´ ì¸ìƒì´ë€ ê±°ì°½í•œ ëª©í‘œë¥¼ í–¥í•´ ë‹¬ë ¤ê°€ëŠ” ë§ˆë¼í†¤ì´ ì•„ë‹ˆë¼, ì´ë ‡ê²Œ ê°€ë” ë©ˆì¶° ì„œì„œ í’ê²½ì„ ë°”ë¼ë³´ëŠ” ì‚°ì±… ê°™ì€ ê²ƒì¼ì§€ë„ ëª¨ë¥¸ë‹¤.'

ë‚˜ëŠ” ê°€ë°©ì—ì„œ ì‘ì€ ë…¸íŠ¸ë¥¼ êº¼ëƒˆë‹¤. ê·¸ë¦¬ê³  íœì„ ë“¤ì–´ ê¾¹ê¾¹ ëˆŒëŸ¬ ì¼ë‹¤.

*ì˜¤ëŠ˜ì˜ ë°”ë‹¤ëŠ” ë‚˜ë¥¼ ë‹®ì•˜ë‹¤. ê±°ì¹ ì§€ë§Œ ììœ ë¡­ê³ , ì°¨ê°‘ì§€ë§Œ ê¹Šë‹¤.*

ë…¸íŠ¸ë¥¼ ë®ì, íŒŒë„ ì†Œë¦¬ê°€ í•œê²° ë” ì„ ëª…í•˜ê²Œ ë“¤ë ¤ì™”ë‹¤. ë‚˜ëŠ” ìë¦¬ì—ì„œ ì¼ì–´ë‚˜ ì˜·ì— ë¬»ì€ ëª¨ë˜ë¥¼ í„¸ì–´ëƒˆë‹¤. ê°€ë²¼ì›Œì§„ ëª¸ê³¼ ë§ˆìŒìœ¼ë¡œ, ë‹¤ì‹œ ê±·ê¸° ì‹œì‘í–ˆë‹¤. ì–´ë””ë¡œ ê°ˆì§€ëŠ” ì •í•˜ì§€ ì•Šì•˜ë‹¤. ê·¸ì € ë°œê¸¸ ë‹¿ëŠ” ëŒ€ë¡œ, ë‚´ ë§ˆìŒì´ ì´ë„ëŠ” ëŒ€ë¡œ.

ë°”ë‹·ë°”ëŒì— ëª¸ì´ ìœ¼ìŠ¬ìœ¼ìŠ¬í•´ì§ˆ ë¬´ë µ, ë‚˜ëŠ” í•´ì•ˆ ë„ë¡œ ëìë½ì— ìˆëŠ” ë‚¡ì€ ì¹´í˜ë¡œ ë“¤ì–´ê°”ë‹¤. ì†ë‹˜ì€ ë‚˜ë¿ì´ì—ˆë‹¤. í¬ë—í•œ ë¨¸ë¦¬ë¥¼ ë‹¨ì •í•˜ê²Œ ë¹—ì–´ ë„˜ê¸´ ì£¼ì¸ì€ ë§ì—†ì´ ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ì„ ë‚´ì–´ì£¼ì—ˆë‹¤.

"íŒŒë„ê°€ ë†’ë„¤ìš”."

ì£¼ì¸ì´ ë¨¼ì € ë§ì„ ê±¸ì–´ì™”ë‹¤. ë‚˜ëŠ” ê¹€ì´ ëª¨ë½ëª¨ë½ ë‚˜ëŠ” ì”ì„ ê°ì‹¸ ì¥ë©° ê³ ê°œë¥¼ ë„ë•ì˜€ë‹¤.

"ë„¤. ë³´ê³  ìˆìœ¼ë©´ ì¢€ ë¬´ì„œìš¸ ì •ë„ë¡œìš”."

"ë¬´ì„œìš´ ê²Œ ë‹¹ì—°í•˜ì£ . ì‚¼í‚¬ ë“¯ì´ ë‹¬ë ¤ë“œë‹ˆê¹Œ."

ì£¼ì¸ì€ ë§ˆë¥¸ í–‰ì£¼ë¡œ ì»µì„ ë‹¦ìœ¼ë©° ì°½ë°–ì„ ë‚´ë‹¤ë³´ì•˜ë‹¤. ê·¸ì˜ ì‹œì„ ì€ íŒŒë„ê°€ ì•„ë‹ˆë¼, ê·¸ ë„ˆë¨¸ì˜ ì–´ë‘ ì„ ì‘ì‹œí•˜ëŠ” ë“¯í–ˆë‹¤.

"ê·¸ëŸ°ë° ì°¸ ì´ìƒí•˜ì£ . ì €ë ‡ê²Œ ì‚¬ë‚©ê²Œ ë¶€ì„œì§€ëŠ”ë°ë„, ê²°êµ­ ë‚¨ëŠ” ê±´ ê³ ìš´ ëª¨ë˜ë¿ì´ë¼ëŠ” ê²Œ."

ë‚˜ëŠ” ê·¸ ë§ì„ ê³±ì”¹ìœ¼ë©° ì»¤í”¼ë¥¼ í•œ ëª¨ê¸ˆ ë§ˆì…¨ë‹¤. ì“´ë§› ë’¤ì— ì˜…ì€ ì‚°ë¯¸ê°€ ê°ëŒì•˜ë‹¤. 'ì´ ì‚¬ëŒ, ë­”ê°€ ì•Œê³  ìˆëŠ” ëˆˆì¹˜ë‹¤.'

"ì‚¬ëŒ ì‚¬ëŠ” ê²ƒë„ ë¹„ìŠ·í•˜ì§€ ì•Šë‚˜ ì‹¶ì–´ìš”. ì¾… í•˜ê³  ë¶€ë”ªì¹  ë• ë‹¤ ê¹¨ì§€ê³  ë¶€ì„œì§ˆ ê²ƒ ê°™ì€ë°, ì§€ë‚˜ê³  ë³´ë©´ ë‘¥ê¸€ê²Œ ê¹ì—¬ ìˆê±°ë“ ìš”. ë‚˜ì²˜ëŸ¼ ëŠ™ì€ì´ê°€ ë˜ë©´ ê·¸ê²Œ ë³´ì—¬ìš”."

ê·¸ëŠ” ì˜…ê²Œ ì›ƒìœ¼ë©° ë‚´ ì•ì— ì‘ì€ ì´ˆì½œë¦¿ í•˜ë‚˜ë¥¼ ë‚´ë ¤ë†“ì•˜ë‹¤.

"ê·¸ëŸ¬ë‹ˆ ë„ˆë¬´ ê²ë¨¹ì§€ ë§ˆìš”. ì•„ê°€ì”¨ëŠ” ì§€ê¸ˆ ëª¨ë˜ê°€ ë˜ì–´ê°€ëŠ” ì¤‘ì¼ í…Œë‹ˆê¹Œ."

ë‚˜ëŠ” ëŒ€ë‹µ ëŒ€ì‹  ì´ˆì½œë¦¿ ê»ì§ˆì„ ê¹ ë‹¤. 'ëª¨ë˜ê°€ ë˜ì–´ê°€ëŠ” ì¤‘...' ë‹¬ì½¤í•œ í–¥ì´ ì½”ëì„ ìŠ¤ì³¤ë‹¤. ìœ„ë¡œë¼ëŠ” ë§ í•œë§ˆë”” ì—†ì—ˆì§€ë§Œ, ê·¸ ì–´ë–¤ ìœ„ë¡œë³´ë‹¤ë„ íˆ¬ë°•í•˜ê³  ë‹¨ë‹¨í•œ ë¬´ì–¸ê°€ê°€ ê°€ìŠ´ í•œêµ¬ì„ì— íˆ­, í•˜ê³  ë–¨ì–´ì§€ëŠ” ê¸°ë¶„ì´ì—ˆë‹¤.`;

      // Reset to Default (Empty)
      function resetConstraints() {
        maxParagraphsInput.value = "";
        maxSentencesInput.value = "";
        maxWordsInput.value = "";
        maxCharsInput.value = "";

        const inputs = [maxParagraphsInput, maxSentencesInput, maxWordsInput, maxCharsInput];
        inputs.forEach((input) => {
          input.classList.add("bg-yellow-50", "ring-2", "ring-yellow-200");
          setTimeout(() => {
            input.classList.remove("bg-yellow-50", "ring-2", "ring-yellow-200");
          }, 400);
        });

        if (sourceTextInput.value.trim()) {
          processText();
        }
      }

      // Theme Handling
      function setTheme(themeName) {
        document.querySelectorAll(".theme-btn").forEach((btn) => {
          btn.classList.remove(
            "theme-active",
            "ring-2",
            "ring-slate-700",
            "ring-offset-2",
            "bg-slate-50",
          );
        });
        const activeBtn = document.getElementById(`btn-${themeName}`);
        activeBtn.classList.add("theme-active");

        document.body.setAttribute("data-theme", themeName);
      }

      // Real-time source counting
      sourceTextInput.addEventListener("input", () => {
        const text = sourceTextInput.value;
        const sentences = splitIntoSentences(text);
        sourceCount.textContent = `${text.length}ì / ${sentences.length}ë¬¸ì¥`;
      });

      function insertSample() {
        sourceTextInput.value = sampleText;
        sourceTextInput.dispatchEvent(new Event("input"));

        // Default to empty (Unlimited) for sample so they see original structure
        maxParagraphsInput.value = "";
        maxSentencesInput.value = "";
        maxWordsInput.value = "";
        maxCharsInput.value = "";

        processText();
      }

      function clearAll() {
        sourceTextInput.value = "";
        outputArea.innerHTML = `<div class="h-full flex flex-col items-center justify-center text-slate-300 space-y-3">
                            <i class="fas fa-align-left text-3xl opacity-30"></i>
                            <span class="text-sm">ì¢Œì¸¡ì˜ 'êµ¬ì¡°í™” ì‹¤í–‰'ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</span>
                        </div>`;
        sourceCount.textContent = "0ì / 0ë¬¸ì¥";
        outputCount.style.opacity = "0";
        resultStats.style.opacity = "0";
      }

      function splitIntoSentences(text) {
        if (!text) return [];
        // Basic splitting logic
        const match = text.match(/[^.!?\n]+[.!?]+["']?|[^.!?\n]+$/g);
        if (!match) return [text];
        return match.map((s) => s.trim()).filter((s) => s.length > 0);
      }

      function highlightContent(text) {
        // Apply common class and specific classes
        let formatted = text.replace(
          /"([^"]*)"/g,
          '<span class="highlight-dialogue">"$1"</span>',
        );
        formatted = formatted.replace(
          /'([^']*)'/g,
          "<span class=\"highlight-thought\">'$1'</span>",
        );
        return formatted;
      }

      function countWords(text) {
        return text.trim().split(/\s+/).filter(w => w.length > 0).length;
      }

      function trimByWords(paragraphs, maxW) {
        let wordCount = 0;
        const result = [];
        for (const para of paragraphs) {
          // plain text ê¸°ì¤€ ë‹¨ì–´ ìˆ˜ ê³„ì‚°
          const temp = document.createElement("div");
          temp.innerHTML = para;
          const plain = temp.textContent || "";
          const words = plain.trim().split(/\s+/).filter(w => w.length > 0);

          if (wordCount + words.length <= maxW) {
            result.push(para);
            wordCount += words.length;
          } else {
            // ì´ ë¬¸ë‹¨ì—ì„œ ë‚¨ì€ ë‹¨ì–´ë§Œí¼ë§Œ ìë¥´ê¸°
            const remaining = maxW - wordCount;
            if (remaining > 0) {
              // HTML span ìœ ì§€í•˜ë©° ë‹¨ì–´ ìˆ˜ë¡œ ìë¥´ëŠ” ê±´ ë³µì¡í•˜ë¯€ë¡œ
              // plain text ê¸°ì¤€ìœ¼ë¡œ ë‹¨ì–´ ì˜ë¼ì„œ ì¶”ê°€
              const cutPlain = words.slice(0, remaining).join(" ");
              result.push(cutPlain + "â€¦");
            }
            break;
          }
        }
        return result;
      }

      function trimByChars(paragraphs, maxC) {
        let charCount = 0;
        const result = [];
        for (const para of paragraphs) {
          const temp = document.createElement("div");
          temp.innerHTML = para;
          const plain = (temp.textContent || "").replace(/\s/g, "");
          const len = plain.length;

          if (charCount + len <= maxC) {
            result.push(para);
            charCount += len;
          } else {
            const remaining = maxC - charCount;
            if (remaining > 0) {
              // ê¸€ì ê¸°ì¤€ìœ¼ë¡œ plain text ì˜ë¼ì„œ ì¶”ê°€
              const temp2 = document.createElement("div");
              temp2.innerHTML = para;
              const plainFull = temp2.textContent || "";
              // ê³µë°± í¬í•¨ ê¸€ì ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ìë¥´ê¸° (ê³µë°± ì œì™¸ remaining)
              let noSpaceCount = 0;
              let cutIdx = 0;
              for (let i = 0; i < plainFull.length; i++) {
                if (plainFull[i] !== ' ' && plainFull[i] !== '\n') noSpaceCount++;
                if (noSpaceCount >= remaining) { cutIdx = i + 1; break; }
              }
              result.push(highlightContent(plainFull.slice(0, cutIdx)) + "â€¦");
            }
            break;
          }
        }
        return result;
      }

      function processText() {
        const rawText = sourceTextInput.value;
        if (!rawText.trim()) {
          outputArea.innerHTML = `<div class="h-full flex flex-col items-center justify-center text-red-300 space-y-3">
                            <i class="fas fa-exclamation-circle text-3xl opacity-50"></i>
                            <span class="text-sm">ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
                        </div>`;
          return;
        }

        // Check if constraints are empty (Original Mode)
        const isUnlimited =
          maxParagraphsInput.value === "" && maxSentencesInput.value === "";

        const maxW = parseInt(maxWordsInput.value) || Infinity;
        const maxC = parseInt(maxCharsInput.value) || Infinity;

        let structuredParagraphs = [];
        let finalSentenceCount = 0;

        if (isUnlimited) {
          const paragraphs = rawText.split(/\n+/);
          paragraphs.forEach((para) => {
            if (para.trim().length > 0) {
              const sents = splitIntoSentences(para);
              finalSentenceCount += sents.length;
              structuredParagraphs.push(highlightContent(para));
            }
          });
        } else {
          const maxP = parseInt(maxParagraphsInput.value) || Infinity;
          const maxS = parseInt(maxSentencesInput.value) || Infinity;
          const sentences = splitIntoSentences(rawText);
          let currentParagraph = [];

          for (let i = 0; i < sentences.length; i++) {
            if (structuredParagraphs.length >= maxP) break;

            finalSentenceCount++;
            currentParagraph.push(highlightContent(sentences[i]));

            if (currentParagraph.length >= maxS) {
              structuredParagraphs.push(currentParagraph.join(" "));
              currentParagraph = [];
            }
          }

          if (
            currentParagraph.length > 0 &&
            structuredParagraphs.length < maxP
          ) {
            structuredParagraphs.push(currentParagraph.join(" "));
          }
        }

        // ë‹¨ì–´ ìˆ˜ ì œí•œ ì ìš©
        if (maxW !== Infinity) {
          structuredParagraphs = trimByWords(structuredParagraphs, maxW);
        }
        // ê¸€ì ìˆ˜ ì œí•œ ì ìš© (ê³µë°± ì œì™¸ ê¸°ì¤€)
        if (maxC !== Infinity) {
          structuredParagraphs = trimByChars(structuredParagraphs, maxC);
        }

        // Render
        if (structuredParagraphs.length === 0) {
          outputArea.innerHTML =
            '<span class="text-slate-400">ê²°ê³¼ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>';
          resultStats.style.opacity = "0";
          outputCount.style.opacity = "0";
        } else {
          const finalHtml = structuredParagraphs
            .map((p) => `<p class="mb-6 last:mb-0 text-justify">${p}</p>`)
            .join("");
          outputArea.innerHTML = finalHtml;

          // Stats
          const tempDiv = document.createElement("div");
          tempDiv.innerHTML = finalHtml;
          const plainText = tempDiv.textContent || tempDiv.innerText || "";
          const plainNoSpace = plainText.replace(/\s/g, "");
          const wordCount = countWords(plainText);

          // í†µê³„ í‘œì‹œ: ë‹¨ì–´/ê¸€ì ì œí•œ ì—¬ë¶€ì— ë”°ë¼ í‘œì‹œ ë‚´ìš© ë‹¬ë¼ì§
          let statParts = [`${plainNoSpace.length}ì`, `${finalSentenceCount}ë¬¸ì¥`];
          if (maxW !== Infinity || maxC === Infinity && maxW === Infinity) {
            statParts.splice(1, 0, `${wordCount}ë‹¨ì–´`);
          }
          outputCount.textContent = `${plainNoSpace.length}ì / ${wordCount}ë‹¨ì–´ / ${finalSentenceCount}ë¬¸ì¥`;
          outputCount.style.opacity = "1";

          // resultStats í† ìŠ¤íŠ¸
          const limitParts = [];
          if (!isUnlimited) limitParts.push(`${structuredParagraphs.length}ë¬¸ë‹¨`);
          if (maxW !== Infinity) limitParts.push(`â‰¤${maxW}ë‹¨ì–´`);
          if (maxC !== Infinity) limitParts.push(`â‰¤${maxC}ì`);
          const limitText = limitParts.length > 0 ? limitParts.join(" Â· ") : "ì›ë³¸ ìœ ì§€";
          resultStats.textContent = `ìƒì„±ë¨: ${limitText}`;
          resultStats.style.opacity = "1";
        }
      }

      function copyToClipboard() {
        const text = outputArea.innerText;
        if (!text || text.includes("ì¢Œì¸¡ì˜")) return;

        navigator.clipboard.writeText(text).then(() => {
          const btn = document.querySelector(
            'button[onclick="copyToClipboard()"]',
          );
          const originalHtml = btn.innerHTML;
          btn.innerHTML = '<i class="fas fa-check mr-1"></i> ë³µì‚¬ë¨';
          btn.classList.remove("bg-slate-800");
          btn.classList.add("bg-green-600");

          setTimeout(() => {
            btn.innerHTML = originalHtml;
            btn.classList.remove("bg-green-600");
            btn.classList.add("bg-slate-800");
          }, 2000);
        });
      }
    </script>
  </body>
</html>
